{"version":3,"file":"sticky.mjs","names":["computed","onBeforeUnmount","onMounted","ref","watch","convertToUnit","useSticky","rootEl","isSticky","layoutItemStyles","isStuck","stuckPosition","stickyStyles","side","value","top","bottom","height","undefined","val","window","addEventListener","onScroll","passive","removeEventListener","immediate","document","lastScrollTop","direction","scrollY","rect","getBoundingClientRect","layoutTop","parseFloat","Math","max","innerHeight"],"sources":["../../../src/components/VNavigationDrawer/sticky.ts"],"sourcesContent":["import type { CSSProperties, Ref } from 'vue'\nimport { computed, onBeforeUnmount, onMounted, ref, watch } from 'vue'\nimport { convertToUnit } from '@/util'\n\ninterface StickyProps {\n  rootEl: Ref<HTMLElement | undefined>\n  isSticky: Ref<boolean>\n  layoutItemStyles: Ref<CSSProperties>\n}\n\nexport function useSticky ({ rootEl, isSticky, layoutItemStyles }: StickyProps) {\n  const isStuck = ref<boolean | 'top' | 'bottom'>(false)\n  const stuckPosition = ref(0)\n\n  const stickyStyles = computed(() => {\n    const side = typeof isStuck.value === 'boolean' ? 'top' : isStuck.value\n    return [\n      isSticky.value ? { top: 'auto', bottom: 'auto', height: undefined } : undefined,\n      isStuck.value\n        ? { [side]: convertToUnit(stuckPosition.value) }\n        : { top: layoutItemStyles.value.top },\n    ]\n  })\n\n  onMounted(() => {\n    watch(isSticky, val => {\n      if (val) {\n        window.addEventListener('scroll', onScroll, { passive: true })\n      } else {\n        window.removeEventListener('scroll', onScroll)\n      }\n    }, { immediate: true })\n  })\n\n  onBeforeUnmount(() => {\n    document.removeEventListener('scroll', onScroll)\n  })\n\n  let lastScrollTop = 0\n  function onScroll () {\n    const direction = lastScrollTop > window.scrollY ? 'up' : 'down'\n    const rect = rootEl.value!.getBoundingClientRect()\n    const layoutTop = parseFloat(layoutItemStyles.value.top ?? 0)\n    const top = window.scrollY - Math.max(0, stuckPosition.value - layoutTop)\n    const bottom =\n      rect.height +\n      Math.max(stuckPosition.value, layoutTop) -\n      window.scrollY -\n      window.innerHeight\n\n    if (rect.height < window.innerHeight - layoutTop) {\n      isStuck.value = 'top'\n      stuckPosition.value = layoutTop\n    } else if (\n      (direction === 'up' && isStuck.value === 'bottom') ||\n      (direction === 'down' && isStuck.value === 'top')\n    ) {\n      stuckPosition.value = window.scrollY + rect.top\n      isStuck.value = true\n    } else if (direction === 'down' && bottom <= 0) {\n      stuckPosition.value = 0\n      isStuck.value = 'bottom'\n    } else if (direction === 'up' && top <= 0) {\n      stuckPosition.value = rect.top + top\n      isStuck.value = 'top'\n    }\n\n    lastScrollTop = window.scrollY\n  }\n\n  return { isStuck, stickyStyles }\n}\n"],"mappings":"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"}