{"version":3,"file":"VFileInput.mjs","names":["filterFieldProps","makeVFieldProps","filterInputProps","makeVInputProps","VInput","VChip","VCounter","VField","IconValue","forwardRefs","useLocale","useProxiedModel","computed","nextTick","ref","defineComponent","filterInputAttrs","humanReadableFileSize","useRender","wrapInArray","VFileInput","name","inheritAttrs","props","chips","Boolean","counter","counterSizeString","type","String","default","counterString","multiple","hint","persistentHint","placeholder","showSize","Number","validator","v","includes","prependIcon","modelValue","Array","val","every","clearable","emits","e","files","setup","attrs","emit","slots","t","model","base","undefined","totalBytes","value","reduce","bytes","size","totalBytesReadable","fileNames","map","file","counterValue","fileCount","length","vInputRef","vFieldRef","isFocused","inputRef","messages","onFocus","document","activeElement","focus","onControlClick","click","onClear","stopPropagation","hasCounter","hasDetails","details","rootAttrs","inputAttrs","_","inputProps","fieldProps","isDisabled","isDirty","isReadonly","isValid","class","fieldClass","slotProps","target","selection","text","color","join"],"sources":["../../../src/components/VFileInput/VFileInput.tsx"],"sourcesContent":["// Styles\nimport './VFileInput.sass'\n\n// Components\nimport { filterFieldProps, makeVFieldProps } from '@/components/VField/VField'\nimport { filterInputProps, makeVInputProps, VInput } from '@/components/VInput/VInput'\nimport { VChip } from '@/components/VChip'\nimport { VCounter } from '@/components/VCounter'\nimport { VField } from '@/components/VField'\n\n// Composables\nimport { IconValue } from '@/composables/icons'\nimport { forwardRefs } from '@/composables/forwardRefs'\nimport { useLocale } from '@/composables/locale'\nimport { useProxiedModel } from '@/composables/proxiedModel'\n\n// Utilities\nimport { computed, nextTick, ref } from 'vue'\nimport { defineComponent, filterInputAttrs, humanReadableFileSize, useRender, wrapInArray } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\n\nexport const VFileInput = defineComponent({\n  name: 'VFileInput',\n\n  inheritAttrs: false,\n\n  props: {\n    chips: Boolean,\n    counter: Boolean,\n    counterSizeString: {\n      type: String,\n      default: '$vuetify.fileInput.counterSize',\n    },\n    counterString: {\n      type: String,\n      default: '$vuetify.fileInput.counter',\n    },\n    multiple: Boolean,\n    hint: String,\n    persistentHint: Boolean,\n    placeholder: String,\n    showSize: {\n      type: [Boolean, Number] as PropType<boolean | 1000 | 1024>,\n      default: false,\n      validator: (v: boolean | number) => {\n        return (\n          typeof v === 'boolean' ||\n          [1000, 1024].includes(v)\n        )\n      },\n    },\n\n    ...makeVInputProps(),\n\n    prependIcon: {\n      type: IconValue,\n      default: '$file',\n    },\n    modelValue: {\n      type: Array as PropType<File[]>,\n      default: () => ([]),\n      validator: (val: any) => {\n        return wrapInArray(val).every(v => v != null && typeof v === 'object')\n      },\n    },\n\n    ...makeVFieldProps({ clearable: true }),\n  },\n\n  emits: {\n    'click:clear': (e: MouseEvent) => true,\n    'click:control': (e: MouseEvent) => true,\n    'update:modelValue': (files: File[]) => true,\n  },\n\n  setup (props, { attrs, emit, slots }) {\n    const { t } = useLocale()\n    const model = useProxiedModel(props, 'modelValue')\n    const base = computed(() => typeof props.showSize !== 'boolean' ? props.showSize : undefined)\n    const totalBytes = computed(() => (model.value ?? []).reduce((bytes, { size = 0 }) => bytes + size, 0))\n    const totalBytesReadable = computed(() => humanReadableFileSize(totalBytes.value, base.value))\n\n    const fileNames = computed(() => (model.value ?? []).map(file => {\n      const { name = '', size = 0 } = file\n\n      return !props.showSize\n        ? name\n        : `${name} (${humanReadableFileSize(size, base.value)})`\n    }))\n\n    const counterValue = computed(() => {\n      const fileCount = model.value?.length ?? 0\n      if (props.showSize) return t(props.counterSizeString, fileCount, totalBytesReadable.value)\n      else return t(props.counterString, fileCount)\n    })\n    const vInputRef = ref<VInput>()\n    const vFieldRef = ref<VInput>()\n    const isFocused = ref(false)\n    const inputRef = ref<HTMLInputElement>()\n    const messages = computed(() => {\n      return props.messages.length\n        ? props.messages\n        : (props.persistentHint) ? props.hint : ''\n    })\n    function onFocus () {\n      if (inputRef.value !== document.activeElement) {\n        inputRef.value?.focus()\n      }\n\n      if (!isFocused.value) {\n        isFocused.value = true\n      }\n    }\n    function onControlClick (e: MouseEvent) {\n      inputRef.value?.click()\n\n      emit('click:control', e)\n    }\n    function onClear (e: MouseEvent) {\n      e.stopPropagation()\n\n      onFocus()\n\n      nextTick(() => {\n        model.value = []\n\n        if (inputRef?.value) {\n          inputRef.value.value = ''\n        }\n\n        emit('click:clear', e)\n      })\n    }\n\n    useRender(() => {\n      const hasCounter = !!(slots.counter || props.counter)\n      const hasDetails = !!(hasCounter || slots.details)\n      const [rootAttrs, inputAttrs] = filterInputAttrs(attrs)\n      const [{ modelValue: _, ...inputProps }] = filterInputProps(props)\n      const [fieldProps] = filterFieldProps(props)\n\n      return (\n        <VInput\n          ref={ vInputRef }\n          v-model={ model.value }\n          class=\"v-file-input\"\n          { ...rootAttrs }\n          { ...inputProps }\n          onClick:prepend={ onControlClick }\n          messages={ messages.value }\n        >\n          {{\n            ...slots,\n            default: ({\n              isDisabled,\n              isDirty,\n              isReadonly,\n              isValid,\n            }) => (\n              <VField\n                ref={ vFieldRef }\n                prepend-icon={ props.prependIcon }\n                onClick:control={ onControlClick }\n                onClick:clear={ onClear }\n                { ...fieldProps }\n                active={ isDirty.value || isFocused.value }\n                dirty={ isDirty.value }\n                focused={ isFocused.value }\n                error={ isValid.value === false }\n              >\n                {{\n                  ...slots,\n                  default: ({\n                    props: { class: fieldClass, ...slotProps },\n                  }) => (\n                    <>\n                      <input\n                        ref={ inputRef }\n                        type=\"file\"\n                        readonly={ isReadonly.value }\n                        disabled={ isDisabled.value }\n                        multiple={ props.multiple }\n                        name={ props.name }\n                        onClick={ e => {\n                          e.stopPropagation()\n\n                          onFocus()\n                        } }\n                        onChange={ e => {\n                          if (!e.target) return\n\n                          const target = e.target as HTMLInputElement\n                          model.value = [...target.files ?? []]\n                        } }\n                        onFocus={ onFocus }\n                        onBlur={ () => (isFocused.value = false) }\n                        { ...slotProps }\n                        { ...inputAttrs }\n                      />\n\n                      { model.value.length > 0 && (\n                        <div class={ fieldClass }>\n                          { slots.selection ? slots.selection({\n                            fileNames: fileNames.value,\n                            totalBytes: totalBytes.value,\n                            totalBytesReadable: totalBytesReadable.value,\n                          })\n                          : props.chips ? fileNames.value.map(text => (\n                            <VChip\n                              key={ text }\n                              size=\"small\"\n                              color={ props.color }\n                            >{ text }</VChip>\n                          ))\n                          : fileNames.value.join(', ') }\n                        </div>\n                      ) }\n                    </>\n                  ),\n                }}\n              </VField>\n            ),\n            details: hasDetails ? slotProps => (\n              <>\n                { slots.details?.(slotProps) }\n\n                { hasCounter && (\n                  <>\n                    <span />\n\n                    <VCounter\n                      active={ !!model.value.length }\n                      value={ counterValue.value }\n                      v-slots={ slots.counter }\n                    />\n                  </>\n                ) }\n              </>\n            ) : undefined,\n          }}\n        </VInput>\n      )\n    })\n\n    return forwardRefs({}, vInputRef, vFieldRef, inputRef)\n  },\n})\n\nexport type VFileInput = InstanceType<typeof VFileInput>\n"],"mappings":"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"}