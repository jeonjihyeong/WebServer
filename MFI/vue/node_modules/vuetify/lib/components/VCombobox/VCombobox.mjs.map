{"version":3,"file":"VCombobox.mjs","names":["makeSelectProps","VCheckboxBtn","VChip","VDefaultsProvider","VList","VListItem","VMenu","VTextField","makeFilterProps","useFilter","makeTransitionProps","transformItem","useItems","forwardRefs","useLocale","useProxiedModel","useTextColor","computed","mergeProps","nextTick","ref","watch","genericComponent","useRender","wrapInArray","highlightResult","text","matches","length","Array","isArray","Error","substr","VCombobox","name","props","delimiters","filterKeys","hideNoData","returnObject","transition","emits","val","setup","emit","slots","t","vTextFieldRef","isFocused","isPristine","menu","selectionIndex","color","value","items","transformIn","transformOut","textColorClasses","textColorStyles","model","v","transformed","multiple","_search","search","get","set","values","split","RegExp","join","forEach","trim","select","filteredItems","undefined","selections","map","find","item","selected","selection","onClear","e","openOnClear","onClickControl","onKeydown","selectionStart","preventDefault","includes","key","prev","setSelectionRange","next","onAfterLeave","index","findIndex","splice","title","hasChips","chips","chip","modelValue","menuIcon","default","eager","menuProps","noDataText","onClick","prepend","isSelected","hideSelected","onChipClose","stopPropagation","slotProps","closable","closableChips","size"],"sources":["../../../src/components/VCombobox/VCombobox.tsx"],"sourcesContent":["// Styles\nimport './VCombobox.sass'\n\n// Components\nimport { makeSelectProps } from '@/components/VSelect/VSelect'\nimport { VCheckboxBtn } from '@/components/VCheckbox'\nimport { VChip } from '@/components/VChip'\nimport { VDefaultsProvider } from '@/components/VDefaultsProvider'\nimport { VList, VListItem } from '@/components/VList'\nimport { VMenu } from '@/components/VMenu'\nimport { VTextField } from '@/components/VTextField'\n\n// Composables\nimport { makeFilterProps, useFilter } from '@/composables/filter'\nimport { makeTransitionProps } from '@/composables/transition'\nimport { transformItem, useItems } from '@/composables/items'\nimport { forwardRefs } from '@/composables/forwardRefs'\nimport { useLocale } from '@/composables/locale'\nimport { useProxiedModel } from '@/composables/proxiedModel'\nimport { useTextColor } from '@/composables/color'\n\n// Utility\nimport { computed, mergeProps, nextTick, ref, watch } from 'vue'\nimport { genericComponent, useRender, wrapInArray } from '@/util'\n\n// Types\nimport type { FilterMatch } from '@/composables/filter'\nimport type { InternalItem } from '@/composables/items'\nimport type { MakeSlots } from '@/util'\nimport type { PropType } from 'vue'\nimport type { VFieldSlots } from '@/components/VField/VField'\nimport type { VInputSlots } from '@/components/VInput/VInput'\n\nfunction highlightResult (text: string, matches: FilterMatch, length: number) {\n  if (Array.isArray(matches)) throw new Error('Multiple matches is not implemented')\n\n  return typeof matches === 'number' && ~matches\n    ? (\n      <>\n        <span class=\"v-combobox__unmask\">{ text.substr(0, matches) }</span>\n        <span class=\"v-combobox__mask\">{ text.substr(matches, length) }</span>\n        <span class=\"v-combobox__unmask\">{ text.substr(matches + length) }</span>\n      </>\n    )\n    : text\n}\n\ntype Primitive = string | number | boolean | symbol\n\ntype Val <T, ReturnObject extends boolean> = T extends Primitive\n  ? T\n  : (ReturnObject extends true ? T : any)\n\ntype Value <T, ReturnObject extends boolean, Multiple extends boolean> =\n  Multiple extends true\n    ? Val<T, ReturnObject>[]\n    : Val<T, ReturnObject>\n\nexport const VCombobox = genericComponent<new <\n  T,\n  ReturnObject extends boolean = true,\n  Multiple extends boolean = false,\n  V extends Value<T, ReturnObject, Multiple> = Value<T, ReturnObject, Multiple>\n>() => {\n  $props: {\n    items?: readonly T[]\n    returnObject?: ReturnObject\n    multiple?: Multiple\n    modelValue?: Readonly<V>\n    'onUpdate:modelValue'?: (val: V) => void\n  }\n  $slots: Omit<VInputSlots & VFieldSlots, 'default'> & MakeSlots<{\n    item: [{ item: T, index: number, props: Record<string, unknown> }]\n    chip: [{ item: T, index: number, props: Record<string, unknown> }]\n    selection: [{ item: T, index: number }]\n    'no-data': []\n  }>\n}>()({\n  name: 'VCombobox',\n\n  props: {\n    // TODO: implement post keyboard support\n    // autoSelectFirst: Boolean,\n    delimiters: Array as PropType<string[]>,\n\n    ...makeFilterProps({ filterKeys: ['title'] }),\n    ...makeSelectProps({ hideNoData: true, returnObject: true }),\n    ...makeTransitionProps({ transition: false }),\n  },\n\n  emits: {\n    'update:modelValue': (val: any) => true,\n    'update:searchInput': (val: string) => true,\n    'update:menu': (val: boolean) => true,\n  },\n\n  setup (props, { emit, slots }) {\n    const { t } = useLocale()\n    const vTextFieldRef = ref()\n    const isFocused = ref(false)\n    const isPristine = ref(true)\n    const menu = useProxiedModel(props, 'menu')\n    const selectionIndex = ref(-1)\n    const color = computed(() => vTextFieldRef.value?.color)\n    const { items, transformIn, transformOut } = useItems(props)\n    const { textColorClasses, textColorStyles } = useTextColor(color)\n    const model = useProxiedModel(\n      props,\n      'modelValue',\n      [],\n      v => transformIn(wrapInArray(v || [])),\n      v => {\n        const transformed = transformOut(v)\n        return props.multiple ? transformed : (transformed[0] ?? null)\n      }\n    )\n    const _search = ref('')\n    const search = computed<string>({\n      get: () => {\n        return _search.value\n      },\n      set: val => {\n        _search.value = val\n        if (!props.multiple) {\n          model.value = [transformItem(props, val)]\n        }\n\n        if (val && props.multiple && props.delimiters?.length) {\n          const values = val.split(new RegExp(`(?:${props.delimiters.join('|')})+`))\n          if (values.length > 1) {\n            values.forEach(v => {\n              v = v.trim()\n              if (v) select(transformItem(props, v))\n            })\n            _search.value = ''\n          }\n        }\n\n        if (!val) selectionIndex.value = -1\n        if (isFocused.value) menu.value = true\n\n        isPristine.value = !val\n      },\n    })\n    watch(_search, value => {\n      emit('update:searchInput', value)\n    })\n\n    const { filteredItems } = useFilter(props, items, computed(() => isPristine.value ? undefined : search.value))\n\n    const selections = computed(() => {\n      return model.value.map(v => {\n        return items.value.find(item => item.value === v.value) || v\n      })\n    })\n    const selected = computed(() => selections.value.map(selection => selection.props.value))\n    const selection = computed(() => selections.value[selectionIndex.value])\n\n    function onClear (e: MouseEvent) {\n      model.value = []\n\n      if (props.openOnClear) {\n        menu.value = true\n      }\n    }\n    function onClickControl () {\n      if (props.hideNoData && !filteredItems.value.length) return\n\n      menu.value = true\n    }\n    function onKeydown (e: KeyboardEvent) {\n      const selectionStart = vTextFieldRef.value.selectionStart\n      const length = selected.value.length\n\n      if (selectionIndex.value > -1) e.preventDefault()\n\n      if (['Enter', 'ArrowDown'].includes(e.key)) {\n        menu.value = true\n      }\n\n      if (['Escape'].includes(e.key)) {\n        menu.value = false\n      }\n\n      if (['Enter', 'Escape', 'Tab'].includes(e.key)) {\n        isPristine.value = true\n      }\n\n      if (!props.multiple) return\n\n      if (['Backspace', 'Delete'].includes(e.key)) {\n        if (selectionIndex.value < 0) {\n          if (e.key === 'Backspace' && !search.value) {\n            selectionIndex.value = length - 1\n          }\n\n          return\n        }\n\n        select(selection.value)\n\n        nextTick(() => !selection.value && (selectionIndex.value = length - 2))\n      }\n\n      if (e.key === 'ArrowLeft') {\n        if (selectionIndex.value < 0 && selectionStart > 0) return\n\n        const prev = selectionIndex.value > -1\n          ? selectionIndex.value - 1\n          : length - 1\n\n        if (selections.value[prev]) {\n          selectionIndex.value = prev\n        } else {\n          selectionIndex.value = -1\n          vTextFieldRef.value.setSelectionRange(search.value.length, search.value.length)\n        }\n      }\n\n      if (e.key === 'ArrowRight') {\n        if (selectionIndex.value < 0) return\n\n        const next = selectionIndex.value + 1\n\n        if (selections.value[next]) {\n          selectionIndex.value = next\n        } else {\n          selectionIndex.value = -1\n          vTextFieldRef.value.setSelectionRange(0, 0)\n        }\n      }\n\n      if (e.key === 'Enter') {\n        select(transformItem(props, search.value))\n        search.value = ''\n      }\n    }\n    function onAfterLeave () {\n      if (isFocused.value) isPristine.value = true\n    }\n    function select (item: InternalItem) {\n      if (props.multiple) {\n        const index = selected.value.findIndex(selection => selection === item.value)\n\n        if (index === -1) {\n          model.value = [...model.value, item]\n        } else {\n          const value = [...model.value]\n          value.splice(index, 1)\n          model.value = value\n        }\n\n        search.value = ''\n      } else {\n        search.value = item.title\n\n        // watch for search watcher to trigger\n        nextTick(() => {\n          menu.value = false\n          isPristine.value = true\n        })\n      }\n    }\n\n    watch(filteredItems, val => {\n      if (!val.length && props.hideNoData) menu.value = false\n    })\n\n    watch(isFocused, val => {\n      if (val) {\n        selectionIndex.value = -1\n      } else {\n        menu.value = false\n\n        if (!props.multiple || !search.value) return\n\n        model.value = [...model.value, transformItem(props, search.value)]\n        search.value = ''\n      }\n    })\n\n    useRender(() => {\n      const hasChips = !!(props.chips || slots.chip)\n\n      return (\n        <VTextField\n          ref={ vTextFieldRef }\n          v-model={ search.value }\n          onUpdate:modelValue={ v => { if (v == null) model.value = [] } }\n          validationValue={ props.modelValue }\n          class={[\n            'v-combobox',\n            {\n              'v-combobox--active-menu': menu.value,\n              'v-combobox--chips': !!props.chips,\n              'v-combobox--selecting-index': selectionIndex.value > -1,\n              [`v-combobox--${props.multiple ? 'multiple' : 'single'}`]: true,\n            },\n          ]}\n          appendInnerIcon={ props.items.length ? props.menuIcon : undefined }\n          onClick:clear={ onClear }\n          onClick:control={ onClickControl }\n          onClick:input={ onClickControl }\n          onFocus={ () => isFocused.value = true }\n          onBlur={ () => isFocused.value = false }\n          onKeydown={ onKeydown }\n        >\n          {{\n            ...slots,\n            default: () => (\n              <>\n                <VMenu\n                  v-model={ menu.value }\n                  activator=\"parent\"\n                  contentClass=\"v-combobox__content\"\n                  eager={ props.eager }\n                  openOnClick={ false }\n                  closeOnContentClick={ false }\n                  transition={ props.transition }\n                  onAfterLeave={ onAfterLeave }\n                  { ...props.menuProps }\n                >\n                  <VList\n                    selected={ selected.value }\n                    selectStrategy={ props.multiple ? 'independent' : 'single-independent' }\n                    onMousedown={ (e: MouseEvent) => e.preventDefault() }\n                  >\n                    { !filteredItems.value.length && !props.hideNoData && (slots['no-data']?.() ?? (\n                      <VListItem title={ t(props.noDataText) } />\n                    )) }\n\n                    { filteredItems.value.map(({ item, matches }, index) => slots.item?.({\n                      item,\n                      index,\n                      props: mergeProps(item.props, { onClick: () => select(item) }),\n                    }) ?? (\n                      <VListItem\n                        key={ index }\n                        { ...item.props }\n                        onClick={ () => select(item) }\n                      >\n                        {{\n                          prepend: ({ isSelected }) => props.multiple && !props.hideSelected ? (\n                            <VCheckboxBtn modelValue={ isSelected } ripple={ false } />\n                          ) : undefined,\n                          title: () => {\n                            return isPristine.value\n                              ? item.title\n                              : highlightResult(item.title, matches.title, search.value?.length ?? 0)\n                          },\n                        }}\n                      </VListItem>\n                    )) }\n                  </VList>\n                </VMenu>\n\n                { selections.value.map((item, index) => {\n                  function onChipClose (e: Event) {\n                    e.stopPropagation()\n                    e.preventDefault()\n\n                    select(item)\n                  }\n\n                  const slotProps = {\n                    'onClick:close': onChipClose,\n                    modelValue: true,\n                  }\n\n                  return (\n                    <div\n                      key={ index }\n                      class={[\n                        'v-combobox__selection',\n                        index === selectionIndex.value && [\n                          'v-combobox__selection--selected',\n                          textColorClasses.value,\n                        ],\n                      ]}\n                      style={ index === selectionIndex.value ? textColorStyles.value : {} }\n                    >\n                      { hasChips ? (\n                        <VDefaultsProvider\n                          defaults={{\n                            VChip: {\n                              closable: props.closableChips,\n                              size: 'small',\n                              text: item.title,\n                            },\n                          }}\n                        >\n                          { slots.chip\n                            ? slots.chip({ item, index, props: slotProps })\n                            : (<VChip { ...slotProps } />)\n                          }\n                        </VDefaultsProvider>\n                      ) : (\n                        slots.selection\n                          ? slots.selection({ item, index })\n                          : (\n                            <span class=\"v-combobox__selection-text\">\n                              { item.title }\n                              { props.multiple && (index < selections.value.length - 1) && (\n                                <span class=\"v-combobox__selection-comma\">,</span>\n                              ) }\n                            </span>\n                          )\n                      ) }\n                    </div>\n                  )\n                }) }\n              </>\n            ),\n          }}\n        </VTextField>\n      )\n    })\n\n    return forwardRefs({\n      isFocused,\n      isPristine,\n      menu,\n      search,\n      selectionIndex,\n      filteredItems,\n      select,\n    }, vTextFieldRef)\n  },\n})\n\nexport type VCombobox = InstanceType<typeof VCombobox>\n"],"mappings":"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"}