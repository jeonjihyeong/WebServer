{"version":3,"file":"defineComponent.mjs","names":["defineComponent","_defineComponent","effectScope","getCurrentInstance","shallowReactive","shallowRef","toRaw","watch","watchEffect","consoleWarn","mergeDeep","toKebabCase","injectSelf","DefaultsSymbol","provideDefaults","useDefaults","propIsDefined","vnode","prop","props","hasOwnProperty","options","_setup","setup","name","_as","String","ctx","vm","defaults","_subcomponentDefaults","_props","globalDefaults","value","global","componentDefaults","subComponents","Object","entries","filter","key","startsWith","length","fromEntries","keys","newVal","setupBindings","scope","val","oldVal","stop","run","immediate","genericComponent","exposeDefaults"],"sources":["../../src/util/defineComponent.tsx"],"sourcesContent":["// Utils\nimport {\n  defineComponent as _defineComponent,\n  effectScope,\n  getCurrentInstance,\n  shallowReactive,\n  shallowRef,\n  toRaw,\n  watch,\n  watchEffect,\n} from 'vue'\nimport { consoleWarn } from '@/util/console'\nimport { mergeDeep, toKebabCase } from '@/util/helpers'\nimport { injectSelf } from '@/util/injectSelf'\nimport { DefaultsSymbol, provideDefaults, useDefaults } from '@/composables/defaults'\n\n// Types\nimport type {\n  ComponentOptions,\n  ComponentOptionsMixin,\n  ComponentOptionsWithObjectProps,\n  ComponentPropsOptions,\n  ComputedOptions,\n  DefineComponent,\n  EffectScope,\n  EmitsOptions,\n  MethodOptions,\n  VNode,\n  VNodeChild,\n} from 'vue'\n\nfunction propIsDefined (vnode: VNode, prop: string) {\n  return vnode.props?.hasOwnProperty(prop) ||\n  vnode.props?.hasOwnProperty(toKebabCase(prop))\n}\n\nexport const defineComponent = (function defineComponent (options: ComponentOptions) {\n  options._setup = options._setup ?? options.setup\n\n  if (!options.name) {\n    consoleWarn('The component is missing an explicit name, unable to generate default prop value')\n\n    return options\n  }\n\n  if (options._setup) {\n    options.props = options.props ?? {}\n    options.props._as = String\n    options.setup = function setup (props: Record<string, any>, ctx) {\n      const vm = getCurrentInstance()!\n      const defaults = useDefaults()\n\n      const _subcomponentDefaults = shallowRef()\n      const _props = shallowReactive({ ...toRaw(props) })\n      watchEffect(() => {\n        const globalDefaults = defaults.value.global\n        const componentDefaults = defaults.value[props._as ?? options.name!]\n\n        if (componentDefaults) {\n          const subComponents = Object.entries(componentDefaults).filter(([key]) => key.startsWith('V'))\n          if (subComponents.length) _subcomponentDefaults.value = Object.fromEntries(subComponents)\n        }\n\n        for (const prop of Object.keys(props)) {\n          let newVal\n          if (propIsDefined(vm.vnode, prop)) {\n            newVal = props[prop]\n          } else {\n            newVal = componentDefaults?.[prop] ?? globalDefaults?.[prop] ?? props[prop]\n          }\n          if (_props[prop] !== newVal) {\n            _props[prop] = newVal\n          }\n        }\n      })\n\n      const setupBindings = options._setup(_props, ctx)\n\n      let scope: EffectScope\n      watch(_subcomponentDefaults, (val, oldVal) => {\n        if (!val && scope) scope.stop()\n        else if (val && !oldVal) {\n          scope = effectScope()\n          scope.run(() => {\n            provideDefaults(mergeDeep(injectSelf(DefaultsSymbol)?.value ?? {}, val))\n          })\n        }\n      }, { immediate: true })\n\n      return setupBindings\n    }\n  }\n\n  return options\n}) as unknown as typeof _defineComponent\n\ntype ToListeners<T extends string | number | symbol> = { [K in T]: K extends `on${infer U}` ? Uncapitalize<U> : K }[T]\nexport type SlotsToProps<T extends Record<string, Slot>> = {\n  $children: () => (T['default'] | VNodeChild | { [K in keyof T]?: T[K] })\n  'v-slots': new () => { [K in keyof T]?: T[K] | false }\n}/* & { // TODO: individual slots are never converted from the constructor type\n  [K in keyof T as `v-slot:${K & string}`]?: new () => (T[K] | false)\n} */\n\ntype Slot<T extends any[] = any[]> = (...args: T) => VNodeChild\nexport type MakeSlots<T extends Record<string, any[]>> = {\n  [K in keyof T]?: Slot<T[K]>\n}\n\nexport function genericComponent<T extends (new () => {\n  $slots?: Record<string, Slot>\n})> (exposeDefaults = true): <\n  PropsOptions extends Readonly<ComponentPropsOptions>,\n  RawBindings,\n  D,\n  C extends ComputedOptions = {},\n  M extends MethodOptions = {},\n  Mixin extends ComponentOptionsMixin = ComponentOptionsMixin,\n  Extends extends ComponentOptionsMixin = ComponentOptionsMixin,\n  E extends EmitsOptions = Record<string, any>,\n  EE extends string = string,\n  I = InstanceType<T>,\n  Base = DefineComponent<\n    (I extends Record<'$props', any> ? Omit<PropsOptions, keyof I['$props']> : PropsOptions) & (\n      I extends Record<'$slots', any>\n        ? SlotsToProps<I['$slots']>\n        : {}\n    ),\n    RawBindings,\n    D,\n    C,\n    M,\n    Mixin,\n    Extends,\n    E extends any[] ? E : I extends Record<'$props', any> ? Omit<E, ToListeners<keyof I['$props']>> : E,\n    EE\n  >\n>(options: ComponentOptionsWithObjectProps<PropsOptions, RawBindings, D, C, M, Mixin, Extends, E, EE>) => Base & T {\n  return options => (exposeDefaults ? defineComponent : _defineComponent)(options) as any\n}\n"],"mappings":"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"}