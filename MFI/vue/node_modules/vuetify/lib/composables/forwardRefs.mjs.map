{"version":3,"file":"forwardRefs.mjs","names":["Refs","Symbol","forwardRefs","target","refs","Proxy","get","key","Reflect","has","ref","value","val","bind","getOwnPropertyDescriptor","descriptor","startsWith","_","setupState","obj","Object","getPrototypeOf","childRefs","queue","slice","length","shift","push","undefined"],"sources":["../../src/composables/forwardRefs.ts"],"sourcesContent":["import type { ComponentPublicInstance, Ref, UnwrapRef } from 'vue'\nimport type { UnionToIntersection } from '@/util'\n\nconst Refs = Symbol('Forwarded refs')\n\n/** Omit properties starting with P */\ntype OmitPrefix<T, P extends string> = Omit<T, keyof T extends `${P}${any}` ? keyof T : never>\n\nexport function forwardRefs<T extends {}, U extends Ref<HTMLElement | Omit<ComponentPublicInstance, '$emit'> | undefined>[]> (\n  target: T,\n  ...refs: U\n): T & OmitPrefix<UnwrapRef<UnionToIntersection<U[number]>>, '$'> {\n  (target as any)[Refs] = refs\n\n  return new Proxy(target, {\n    get (target, key) {\n      if (Reflect.has(target, key)) {\n        return Reflect.get(target, key)\n      }\n      for (const ref of refs) {\n        if (ref.value && Reflect.has(ref.value, key)) {\n          const val = Reflect.get(ref.value, key)\n          return typeof val === 'function'\n            ? val.bind(ref.value)\n            : val\n        }\n      }\n    },\n    getOwnPropertyDescriptor (target, key) {\n      const descriptor = Reflect.getOwnPropertyDescriptor(target, key)\n      if (descriptor) return descriptor\n\n      // Skip internal properties\n      if (typeof key === 'symbol' || key.startsWith('__')) return\n\n      // Check each ref's own properties\n      for (const ref of refs) {\n        if (!ref.value) continue\n        const descriptor = Reflect.getOwnPropertyDescriptor(ref.value, key)\n        if (descriptor) return descriptor\n        if ('_' in ref.value && 'setupState' in ref.value._) {\n          const descriptor = Reflect.getOwnPropertyDescriptor(ref.value._.setupState, key)\n          if (descriptor) return descriptor\n        }\n      }\n      // Recursive search up each ref's prototype\n      for (const ref of refs) {\n        let obj = ref.value && Object.getPrototypeOf(ref.value)\n        while (obj) {\n          const descriptor = Reflect.getOwnPropertyDescriptor(obj, key)\n          if (descriptor) return descriptor\n          obj = Object.getPrototypeOf(obj)\n        }\n      }\n      // Call forwarded refs' proxies\n      for (const ref of refs) {\n        const childRefs = ref.value && (ref.value as any)[Refs]\n        if (!childRefs) continue\n        const queue = childRefs.slice()\n        while (queue.length) {\n          const ref = queue.shift()\n          const descriptor = Reflect.getOwnPropertyDescriptor(ref.value, key)\n          if (descriptor) return descriptor\n          const childRefs = ref.value && (ref.value as any)[Refs]\n          if (childRefs) queue.push(...childRefs)\n        }\n      }\n      return undefined\n    },\n  }) as any\n}\n"],"mappings":"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"}